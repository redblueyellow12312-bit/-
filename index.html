<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>睡眠・行動トラッカー</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="container">
    <header>
      <h1>睡眠・行動トラッカー</h1>
    </header>

    <!-- Home -->
    <section id="view-home">
      <div class="card home-card">
        <div class="row">
          <button id="btnWake"  class="big-act primary" type="button">起床</button>
          <button id="btnSleep" class="big-act dark"    type="button">就寝</button>
        </div>
        <div class="row meta">
          <div>起床: <span id="wakeTime">—</span> <span id="wakeFatigue" class="muted"></span></div>
          <div>就寝: <span id="sleepTime">—</span> <span id="sleepFatigue" class="muted"></span></div>
        </div>
      </div>

      <!-- ▼ 追加：気分・体調 1タップ記録 -->
<div class="card" id="moodBodyCard" style="margin-top:12px;">
  <div class="label">気分（1タップで記録）</div>
  <div id="moodQuick" class="choice-row"></div>

  <div class="label" style="margin-top:8px;">体調（1タップで記録）</div>
  <div id="bodyQuick" class="choice-row"></div>
</div>

    </section>
<!-- 記録ページ -->
<section id="view-record" class="hidden">
  <div class="toolbar">
    <h2>記録</h2>
  </div>
　
  <div class="cat-toolbar">
    <label class="check"><input id="toggleEdit" type="checkbox" /> 編集モード</label>
    <div class="edit-row">
      <input id="catEditName" type="text" placeholder="カテゴリ名を編集" />
      <div id="colorPalette" class="color-palette" aria-label="カテゴリ色を選択"></div>
    </div>
    <div class="edit-row">
      <input id="newCatName" type="text" placeholder="＋ カテゴリ追加（例: 治療）" />
      <button id="addCatBtn" class="btn" type="button">追加</button>
      <button id="delCatBtn" class="btn danger" type="button">選択カテゴリ削除</button>
    </div>
  </div>

  <div class="muted small">カテゴリ → 行動をタップ（開始/停止）。必要なら行動を追加。</div>

  <div id="catList" class="cats"></div>

  <div id="actionArea" class="actions-wrap hidden">
    <div class="actions-head">
      <div><span class="muted small">選択中のカテゴリ：</span><strong id="selectedCatLabel"></strong></div>
    </div>

    <div id="actionList" class="actions"></div>

    <div class="form-inline">
      <input id="newActionName" type="text" placeholder="＋ 行動名を追加 (例: ゲーム)" />
      <button id="addActionBtn" class="btn" type="button">追加</button>
    </div>

    <div class="today-mini">
      <div class="label" style="margin-top:12px;">本日の記録</div>
      <div id="todayMini" class="list"></div>
    </div>
  </div>
</section>



<!-- タスクページ -->
<section id="view-task" class="hidden">
  <div class="toolbar">
    <h2>タスク</h2>
  </div>

  <div class="card">
    <!-- タスク追加行 -->
    <div class="row task-add" style="margin:8px 0 4px">
      <input id="taskTitle" type="text" placeholder="やることを入力…">
      <div class="date-icon-wrap">
        <input id="taskDate" type="date" aria-label="日付を選択">
        <span id="taskDateBtn" class="btn-icon" aria-hidden="true">🗓</span>
      </div>
      <span id="taskDateText" class="muted small"></span>
      <label><input id="taskDaily" type="checkbox"> 毎日</label>
      <button id="taskAddBtn" class="btn">追加</button>
    </div>

    <!-- 進捗表示 -->
    <div class="progress" id="taskProgress" role="progressbar" aria-valuemin="0" aria-valuemax="100" style="margin:8px 0">
      <span></span>
    </div>
    <div class="stat">
      <div id="taskProgressText">対象なし</div>
      <div class="muted">チェック済 / 合計</div>
    </div>

    <!-- タスクリスト -->
    <div id="taskList" class="list" style="margin-top:8px"></div>
  </div>
</section>


    <!-- 確認 -->
    <section id="view-check" class="hidden">
      <div class="toolbar">
        <h2>記録の確認</h2>
        <div class="row" style="gap:8px;flex:none;">
          <button id="toBlog" class="btn" type="button">ブログ出力へ</button>
          <button id="btnExport" class="btn" type="button">書き出し(JSON)</button>
          <label for="fileImport" class="btn" role="button">読み込み</label>
          <input id="fileImport" type="file" accept="application/json" style="display:none" />
        </div>
      </div>
      <div class="datebar">
        <button id="prevDate" class="btn" type="button">← 前日</button>
        <input id="datePick" type="date" />
        <button id="nextDate" class="btn" type="button">翌日 →</button>
      </div>
      <div class="card">
  <div id="checkList" class="list"></div>
  <!-- コメントや行動ログの下に AIアドバイスが来る -->
  <div id="aiAdviceSection" style="margin-top:12px;">
    <div class="label">AIアドバイス</div>
    <pre id="checkAiAdvice" class="preview">（まだアドバイスはありません）</pre>
  </div>
</div>
<!-- ▼ 追加：その日の気分・体調履歴 -->
<div class="card" id="mbHistoryCard" style="margin-top:12px;">
  <div class="label">その日の気分・体調</div>
  <div id="mbHistoryList" class="list"></div>
</div>


      <div id="checkTabs" class="tabs" style="margin:8px 0;">
        <button class="tab" data-tab="day">日</button>
        <button class="tab" data-tab="week">週</button>
        <button class="tab" data-tab="month">月</button>
      </div>

      <!-- 目標設定UI -->
      <div id="goalSetting" class="card" style="margin-top:12px;">
        <div class="row" style="align-items:center; gap:8px;">
          <label for="goalCat">カテゴリ:</label>
          <select id="goalCat"></select>

          <label for="goalAct">行動:</label>
          <select id="goalAct">
            <option value="">（カテゴリ全体）</option>
          </select>
          <label for="goalValue">目標:</label>
          <input id="goalValue" type="number" min="0" step="0.5" value="2"> h
          <button id="saveGoal" class="btn">設定</button>
        </div>
      </div>

      <!-- チャート描画エリア -->
      <div id="chartArea"></div>
    </section>

    <!-- ブログ -->
    <section id="view-blog" class="hidden">
      <div class="toolbar">
        <h2>ブログ出力</h2>
        <div class="row" style="gap:8px;flex:none;">

          <!-- ▼ 追加：AI連携 -->
          <button id="openAiSettingsBlog" class="btn" type="button">API設定</button>
        </div>
      </div>
      <div class="card">
        <div class="muted" style="margin-bottom:8px;">対象日:
          <input id="blogDate" type="date" />
        </div>
        <div class="field">
          <div class="label">1日のコメント（任意・末尾に追記）</div>
          <textarea id="blogComment" placeholder="今日の振り返りなど"></textarea>
        </div>
        <div class="row" style="margin-top:8px;">
          <button id="appendComment" class="btn">追記</button>
          <button id="replaceComment" class="btn">置換</button>
          <button id="deleteComment" class="btn danger">削除</button>
          <button id="copyBlog" class="btn-primary" type="button">ブログ文をコピー</button>
        </div>
  <!-- ▼ ここを追加 -->
 <div class="label" style="margin-top:12px;">AIアドバイス</div>
 <pre id="aiAdvicePreview" class="preview"></pre>
 <div class="row" style="margin-top:8px;">
  <button id="deleteAiAdvice" class="btn danger" type="button">AIアドバイス削除</button>
  <button id="genAdvice" class="btn-primary" type="button">AIアドバイス生成</button>
</div>

  <div class="label" style="margin-top:12px;">プレビュー</div>
  <pre id="blogPreview" class="preview"></pre>
</div>
    </section>

<section id="view-analysis" class="hidden">
  <div class="toolbar">
    <h2>自己分析</h2>
    <button id="openAiSettingsAnalysis" class="btn">AI設定</button>
  </div>

  <div class="card">
    <div class="label">期間指定まとめ</div>
    <input type="date" id="summaryStart"> ～
    <input type="date" id="summaryEnd">
    <button id="genCustomSummary" class="btn-primary" type="button">まとめ作成</button>
  </div>

  <div class="card" style="margin-top:12px;">
    <div class="label">AIまとめプレビュー</div>
    <pre id="summaryAdvicePreview" class="preview"></pre>
    <button id="saveSummary" class="btn" type="button">保存</button>
    <button id="deleteSummary" class="btn btn-danger" type="button">削除</button>
  </div>

  <div class="card" style="margin-top:12px;">
    <div class="label">過去のまとめ一覧</div>
    <div id="summaryList"></div>
  </div>
</section>
  </div>
  <!-- 起床モーダル -->
  <div id="modalWake" class="modal-wrap hidden" aria-modal="true">
    <div class="modal">
      <h3>起床を記録</h3>
      <p class="muted">現在時刻で起床を登録し、状態を選んでください。</p>

      <div class="row">
        <div style="flex:1">
          <div class="section-title">心の疲れ具合</div>
          <div id="mentalScaleWake"></div>
        </div>
        <div style="flex:1">
          <div class="section-title">体の疲れ具合</div>
          <div id="physicalScaleWake"></div>
        </div>
      </div>

      <div style="margin-top:10px">
        <div class="section-title">睡眠の質</div>
        <div id="sleepQualityWake"></div>
      </div>

      <div class="modal-actions">
        <button class="btn" data-close="modalWake" type="button">キャンセル</button>
        <button id="confirmWake" class="btn-primary" type="button">起床を記録</button>
      </div>
    </div>
  </div>

  <!-- 就寝モーダル -->
  <div id="modalSleep" class="modal-wrap hidden" aria-modal="true">
    <div class="modal">
      <h3>就寝を記録</h3>
      <p class="muted">現在時刻で就寝を登録し、状態を選んでください。</p>

      <div class="row">
        <div style="flex:1">
          <div class="section-title">心の疲れ具合</div>
          <div id="mentalScaleSleep"></div>
        </div>
        <div style="flex:1">
          <div class="section-title">体の疲れ具合</div>
          <div id="physicalScaleSleep"></div>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn" data-close="modalSleep" type="button">キャンセル</button>
        <button id="confirmSleep" class="btn-primary" type="button">就寝を記録</button>
      </div>
    </div>
  </div>






  <!-- ▼ 追加：AI設定モーダル -->
  <div id="aiSettingsWrap" class="modal-wrap hidden" aria-modal="true" role="dialog">
    <div class="modal" role="document" style="max-width:560px">
      <h3>AI設定（ローカル保存）</h3>
      <p class="muted" style="margin-top:-6px">
        ※ 個人利用向けにブラウザのローカルストレージへ保存します。公開サイトに載せる場合はサーバー経由をご利用ください。
      </p>

      <div class="field" style="margin-top:8px">
        <div class="label">Gemini APIキー</div>
        <input id="gemApiKey" type="password" placeholder="AIza..." autocomplete="off" />
      </div>

      <div class="field" style="margin-top:8px">
        <div class="label">モデル</div>
        <select id="gemModel">
          <option value="gemini-2.5-flash">gemini-2.5-flash（軽量・速い）</option>
          <option value="gemini-2.5-pro">gemini-2.5-pro（高品質）</option>
        </select>
      </div>

      <div class="field" style="margin-top:8px">
        <div class="label">コーチの方針（任意）</div>
        <textarea id="gemSystemPrompt" placeholder="例）短く具体的に。褒め→改善→明日の一歩の順。「〜しましょう」で優しく。3行以内。"></textarea>
      </div>
      <!-- 既存の「コーチの方針（任意）」の下に追加 -->
<div class="field" style="margin-top:8px">
  <div class="label">自己分析プロンプト（任意）</div>
  <textarea id="gemSummaryPrompt" placeholder="例）1週間/1か月単位での振り返り。課題と改善ポイントを中心にまとめる。"></textarea>
</div>

      <div class="modal-actions">
        <button class="btn" data-close="aiSettings" type="button">閉じる</button>
        <button id="saveGemSettings" class="btn-primary" type="button">保存</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast hidden"><span id="toastMsg"></span></div>
  <script src="./app.js" defer></script>
<!-- ▼ 下タブナビゲーション -->
<div id="tabBar">
  <button data-view="home" class="active">
    <i>🏠</i><span>ホーム</span>
  </button>
<button id="btnRecord" data-view="record">
  <i>📝</i><span>記録</span>
</button>
  <button data-view="check">
    <i>📊</i><span>確認</span>
  </button>
  <button data-view="blog">
    <i>📖</i><span>ブログ</span>
  </button>
  <button data-view="task">
    <i>✅</i><span>タスク</span>
  </button>
  <button data-view="analysis">
    <i>🤖</i><span>分析</span>
  </button>
</div>


</body>
</html>

